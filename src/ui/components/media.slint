import { Palette } from "std-widgets.slint";
import { AppIcons } from "../icons.slint";

export component VolumeSliderControl inherits Rectangle {
    in-out property <float> value: 1.0;
    callback changed(float);
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    private property <length> icon-slot-width: 18px;
    private property <length> track-height: 6px;
    private property <length> handle-base-size: 10px;
    private property <length> handle-hover-size: 12px;
    private property <length> track-center-adjust: root.track-height / 3;
    background: transparent;

    HorizontalLayout {
        spacing: 6px;

        icon-slot := Rectangle {
            width: root.icon-slot-width;
            height: root.height;
            background: transparent;
            Image {
                source: AppIcons.volume;
                width: max(9px, min(12px, root.height * 0.45));
                height: self.width;
                x: (parent.width - self.width) / 2;
                y: (parent.height - self.height) / 2;
                image-fit: contain;
                colorize: root.dark ? #888 : #5f6d7c;
            }
        }

        slider-area := Rectangle {
            horizontal-stretch: 1;
            height: root.height;
            background: transparent;

            volume-track := Rectangle {
                x: 0px;
                y: (parent.height - self.height) / 2 - root.track-center-adjust;
                width: parent.width;
                height: root.track-height;
                border-radius: 3px;
                background: root.dark ? #333 : #d1dae6;
            }

            Rectangle {
                x: volume-track.x;
                y: volume-track.y;
                width: volume-track.width * root.value;
                height: volume-track.height;
                background: #2a6def;
                border-radius: 3px;
            }

            volume-handle := Rectangle {
                width: root.handle-base-size;
                height: root.handle-base-size;
                x: volume-track.width > 0px ? volume-track.x + (volume-track.width * root.value) - self.width / 2 : volume-track.x;
                y: volume-track.y + (volume-track.height - self.height) / 2;
                background: white;
                border-radius: 5px;
                animate x { duration: 100ms; easing: ease-out; }
            }

            states [
                hover when ta-volume.has-hover || ta-volume.pressed: {
                    volume-handle.width: root.handle-hover-size;
                    volume-handle.height: root.handle-hover-size;
                }
            ]

            ta-volume := TouchArea {
                x: 0px;
                y: 0px;
                width: parent.width;
                height: parent.height;
                mouse-cursor: pointer;
                clicked => {
                    if (volume-track.width > 0px) {
                        root.value = max(0, min(1, self.mouse-x / volume-track.width));
                        root.changed(root.value);
                    }
                }
                moved => {
                    if (self.pressed && volume-track.width > 0px) {
                        root.value = max(0, min(1, self.mouse-x / volume-track.width));
                        root.changed(root.value);
                    }
                }
            }

            if ta-volume.pressed : Rectangle {
                width: 32px;
                height: 12px;
                x: min(
                    volume-track.x + volume-track.width - self.width - 2px,
                    max(volume-track.x + 2px, volume-handle.x - self.width / 2)
                );
                y: max(0px, volume-track.y - self.height - 2px);
                z: 10;
                border-radius: 3px;
                background: root.dark ? #1f1f1f : #f4f7fb;
                border-width: 1px;
                border-color: root.dark ? #3a3a3a : #c8d2dd;
                Text {
                    text: floor(root.value * 100) + "%";
                    color: root.dark ? #ddd : #263544;
                    font-size: 8px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
        }
    }
}

export component SeekBarControl inherits Rectangle {
    in property <float> position-percentage: 0.0;
    in property <string> elapsed-text: "0:00";
    in property <string> total-text: "0:00";
    callback seek-requested(float);
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    height: 32px;
    background: root.dark ? #242424 : #f3f6fb;
    HorizontalLayout {
        padding-left: 12px;
        padding-right: 12px;
        padding-top: 8px;
        padding-bottom: 8px;
        spacing: 10px;

        Text {
            text: root.elapsed-text;
            color: root.dark ? #888 : #5f6d7c;
            font-size: 12px;
            vertical-alignment: center;
            horizontal-alignment: right;
            width: 45px;
        }

        seekbar := Rectangle {
            height: 6px;
            border-radius: 3px;
            background: root.dark ? #333 : #d1dae6;
            horizontal-stretch: 1;
            Rectangle {
                x: 0;
                y: 0;
                width: seekbar.width * root.position-percentage;
                height: parent.height;
                background: #2a6def;
                border-radius: 3px;
                animate width { duration: 150ms; easing: ease-out; }
            }
            handle := Rectangle {
                width: 12px;
                height: 12px;
                x: (seekbar.width * root.position-percentage) - self.width / 2;
                y: (parent.height - self.height) / 2;
                background: white;
                border-radius: 6px;
                border-width: 1px;
                border-color: root.dark ? #111111 : #4f6174;
                drop-shadow-offset-y: 1px;
                drop-shadow-blur: 2px;
                drop-shadow-color: root.dark ? #00000080 : #00000033;
                animate x { duration: 150ms; easing: ease-out; }
            }
            states [
                hover when ta-seek.has-hover || ta-seek.pressed: {
                    handle.background: #ffffff;
                    handle.width: 14px;
                    handle.height: 14px;
                }
            ]
            ta-seek := TouchArea {
                width: parent.width;
                height: 20px;
                mouse-cursor: pointer;
                clicked => { root.seek-requested(max(0, min(1, self.mouse-x / seekbar.width))); }
                moved => {
                    if (self.pressed) {
                        root.seek-requested(max(0, min(1, self.mouse-x / seekbar.width)));
                    }
                }
            }
        }

        Text {
            text: root.total-text;
            color: root.dark ? #888 : #5f6d7c;
            font-size: 12px;
            vertical-alignment: center;
            width: 45px;
        }
    }
}

export component MetadataViewer inherits Rectangle {
    in property <string> display-title: "";
    in property <string> display-artist: "";
    in property <string> display-album: "";
    in property <string> display-date: "";
    in property <string> display-genre: "";
    private property <bool> has-metadata: root.display-title != ""
        || root.display-artist != ""
        || root.display-album != ""
        || root.display-date != ""
        || root.display-genre != "";
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    background: transparent;
    if root.has-metadata : VerticalLayout {
        spacing: 4px;
        if root.display-title != "" : Text {
            text: root.display-title;
            color: root.dark ? #eee : #243444;
            font-size: 14px;
            font-weight: 700;
            wrap: word-wrap;
            overflow: elide;
        }
        if root.display-artist != "" : Text {
            text: root.display-artist;
            color: root.dark ? #ccc : #4d5d6d;
            font-size: 13px;
            wrap: word-wrap;
            overflow: elide;
        }
        if root.display-album != "" : Text {
            text: root.display-album;
            color: root.dark ? #aaa : #627182;
            font-size: 12px;
            wrap: word-wrap;
            overflow: elide;
        }
        HorizontalLayout {
            spacing: 8px;
            if root.display-date != "" : Text {
                text: root.display-date;
                color: root.dark ? #888 : #6f7d8c;
                font-size: 11px;
            }
            if root.display-genre != "" : Text {
                text: root.display-genre;
                color: root.dark ? #888 : #6f7d8c;
                font-size: 11px;
                horizontal-stretch: 1;
                overflow: elide;
            }
        }
    }

    if !root.has-metadata : Rectangle {
        width: parent.width;
        height: parent.height;
        background: transparent;

        Text {
            text: "No track selected";
            color: root.dark ? #7c7c7c : #6f7d8c;
            font-size: 14px;
            font-weight: 600;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
    }
}

export component AlbumArtViewer inherits Rectangle {
    in property <image> art-source;
    in property <bool> has-art: false;
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    vertical-stretch: 1;
    height: 100px;
    background: root.dark ? #202020 : #f4f7fb;
    border-radius: 4px;

    if root.has-art : Image {
        source: root.art-source;
        width: parent.width;
        height: parent.height;
        image-fit: contain;
    }

    if !root.has-art : Rectangle {
        width: max(80px, min(parent.width - 24px, parent.height - 24px));
        height: self.width;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
        border-radius: 6px;
        border-width: 1px;
        border-color: root.dark ? #393939 : #c7d0db;
        background: root.dark ? #292929 : #ecf1f8;

        Rectangle {
            x: 8px;
            y: 8px;
            width: parent.width - 16px;
            height: parent.height - 16px;
            border-radius: 4px;
            border-width: 1px;
            border-color: root.dark ? #454545 : #c1ccd9;
            background: root.dark ? #2f2f2f : #e2eaf4;

            Image {
                source: AppIcons.music;
                width: 24px;
                height: 24px;
                x: (parent.width - self.width) / 2;
                y: parent.height / 2 - 22px;
                image-fit: contain;
                colorize: root.dark ? #8d8d8d : #6b7786;
            }

            Text {
                text: "No album art";
                y: parent.height / 2 + 8px;
                color: root.dark ? #767676 : #6b7786;
                font-size: 11px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}
