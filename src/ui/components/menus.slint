import { Button, Switch, Palette } from "std-widgets.slint";
import { AppIcons } from "../icons.slint";

export component ContextMenu inherits PopupWindow {
    callback rename();
    callback delete();
    callback sync-opensubsonic();
    in property <bool> is-playlist: false;
    in property <bool> show-sync-item: false;
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;
    width: is-playlist && show-sync-item ? 190px : 120px;
    height: is-playlist ? (show-sync-item ? 84px : 56px) : 32px;

    Rectangle {
        background: root.dark ? #333 : #f0f4fa;
        border-width: 1px;
        border-color: root.dark ? #444 : #c7d1dd;

        VerticalLayout {
            padding: 4px;
            spacing: 4px;
            Rectangle {
                height: 24px;
                background: item-ta-rename.has-hover ? (root.dark ? #444 : #e1e9f2) : transparent;
                border-radius: 2px;
                Text {
                    x: 8px;
                    text: "Rename";
                    color: root.dark ? #eee : #253444;
                    font-size: 13px;
                    vertical-alignment: center;
                }
                item-ta-rename := TouchArea {
                    clicked => {
                        root.rename();
                    }
                }
            }
            if is-playlist && show-sync-item : Rectangle {
                height: 24px;
                background: item-ta-sync.has-hover ? (root.dark ? #444 : #e4ecf6) : transparent;
                border-radius: 2px;
                Text {
                    x: 8px;
                    text: "Sync with OpenSubsonic";
                    color: root.dark ? #b9d7f7 : #2d5f98;
                    font-size: 13px;
                    vertical-alignment: center;
                }
                item-ta-sync := TouchArea {
                    clicked => {
                        root.sync-opensubsonic();
                    }
                }
            }
            if is-playlist : Rectangle {
                height: 24px;
                background: item-ta-delete.has-hover ? (root.dark ? #444 : #f3e3e3) : transparent;
                border-radius: 2px;
                Text {
                    x: 8px;
                    text: "Delete";
                    color: #ff5555;
                    font-size: 13px;
                    vertical-alignment: center;
                }
                item-ta-delete := TouchArea {
                    clicked => {
                        root.delete();
                    }
                }
            }
        }
    }
}

export component ColumnHeaderMenu inherits PopupWindow {
    in property <[string]> labels: [];
    in property <[bool]> checked: [];
    in property <[bool]> custom: [];
    callback toggle-column(int);
    callback delete-column(int);
    callback add-custom();
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    width: 220px;
    height: 16px + labels.length * 24px + 32px;
    close-policy: PopupClosePolicy.close-on-click-outside;

    Rectangle {
        background: root.dark ? #2f2f2f : #f3f6fb;
        border-width: 1px;
        border-color: root.dark ? #454545 : #c7d1dd;
        border-radius: 4px;

        VerticalLayout {
            padding: 4px;
            spacing: 2px;

            for label[i] in root.labels : Rectangle {
                property <bool> is-custom: i < root.custom.length && root.custom[i];
                height: 22px;
                border-radius: 2px;
                background: column-item-ta.has-hover ? (root.dark ? #3d3d3d : #e2eaf4) : transparent;
                column-toggle := Switch {
                    x: 6px;
                    y: (parent.height - self.height) / 2;
                    width: 36px;
                    text: "";
                    checked: i < root.checked.length ? root.checked[i] : false;
                    toggled => {
                        root.toggle-column(i);
                    }
                }
                Text {
                    text: label;
                    color: root.dark ? #ddd : #253444;
                    font-size: 12px;
                    vertical-alignment: center;
                    horizontal-alignment: left;
                    x: 48px;
                    width: parent.width - (parent.is-custom ? 76px : 54px);
                    overflow: elide;
                }
                column-item-ta := TouchArea {
                    x: 48px;
                    width: parent.width - (parent.is-custom ? 72px : 48px);
                    clicked => {
                        root.toggle-column(i);
                    }
                }
                if self.is-custom : Rectangle {
                    width: 18px;
                    height: 18px;
                    x: parent.width - self.width - 6px;
                    y: (parent.height - self.height) / 2;
                    background: transparent;
                    Image {
                        source: AppIcons.close;
                        width: 10px;
                        height: 10px;
                        x: (parent.width - self.width) / 2;
                        y: (parent.height - self.height) / 2;
                        image-fit: contain;
                        colorize: delete-column-ta.has-hover ? #ff5c5c : #db3f3f;
                    }
                    delete-column-ta := TouchArea {
                        clicked => {
                            root.delete-column(i);
                        }
                    }
                }
            }

            Rectangle {
                height: 1px;
                background: root.dark ? #3c3c3c : #d4dce7;
            }

            Rectangle {
                height: 22px;
                border-radius: 2px;
                background: custom-item-ta.has-hover ? (root.dark ? #3d3d3d : #e2eaf4) : transparent;
                Text {
                    text: "Custom...";
                    color: root.dark ? #ddd : #253444;
                    font-size: 12px;
                    vertical-alignment: center;
                    horizontal-alignment: left;
                    x: 6px;
                }
                custom-item-ta := TouchArea {
                    clicked => {
                        root.add-custom();
                    }
                }
            }
        }
    }
}

export component ConfirmationDialog inherits Rectangle {
    callback confirmed();
    callback cancelled();
    in property <string> message: "Are you sure?";
    in property <bool> is-visible: false;
    in property <string> confirm-button-text: "Delete";
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    visible: is-visible;
    background: #00000080;

    // Prevent clicks from passing through
    TouchArea {}

    Rectangle {
        width: min(460px, max(280px, root.width - 24px));
        height: min(240px, max(140px, root.height - 24px));
        x: max(0px, (parent.width - self.width) / 2);
        y: max(0px, (parent.height - self.height) / 2);
        background: root.dark ? #282828 : #f6f8fc;
        border-width: 1px;
        border-color: root.dark ? #444 : #c7d1dd;
        border-radius: 4px;

        VerticalLayout {
            padding: 16px;
            spacing: 12px;

            Text {
                text: root.message;
                color: root.dark ? #eee : #253444;
                font-size: 14px;
                horizontal-alignment: center;
                wrap: word-wrap;
                vertical-stretch: 1;
            }

            HorizontalLayout {
                spacing: 15px;
                alignment: center;

                Button {
                    text: "Cancel";
                    clicked => { root.cancelled(); }
                }

                Button {
                    text: root.confirm-button-text;
                    primary: true;
                    clicked => { root.confirmed(); }
                }
            }
        }
    }
}

export component InfoDialog inherits Rectangle {
    callback dismissed();
    in property <string> title: "Restart Required";
    in property <string> message: "";
    in property <bool> is-visible: false;
    private property <bool> dark: Palette.color-scheme == ColorScheme.dark;

    visible: is-visible;
    background: #00000080;

    TouchArea {}

    Rectangle {
        width: 430px;
        height: 180px;
        background: root.dark ? #282828 : #f6f8fc;
        border-width: 1px;
        border-color: root.dark ? #444 : #c7d1dd;
        border-radius: 4px;

        VerticalLayout {
            padding: 16px;
            spacing: 14px;

            Text {
                text: root.title;
                color: root.dark ? #eee : #253444;
                font-size: 16px;
                font-weight: 700;
                horizontal-alignment: left;
            }

            Text {
                text: root.message;
                color: root.dark ? #ddd : #425365;
                font-size: 13px;
                wrap: word-wrap;
                vertical-stretch: 1;
            }

            HorizontalLayout {
                Rectangle { horizontal-stretch: 1; }
                Button {
                    text: "OK";
                    primary: true;
                    clicked => { root.dismissed(); }
                }
            }
        }
    }
}
